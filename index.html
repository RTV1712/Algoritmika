<body>
    <div class="cover">
        <h1>БАЛЛЫ УЧЕНИКОВ</h1>
        <div class="cover-buttons">
            <button onclick="scrollToContent()" class="cover-button">УЗНАТЬ СВОЙ БАЛЛ</button>
            <a href="https://learn.algoritmika.org/login" target="_blank" class="cover-button">ПЕРЕЙТИ НА ПЛАТФОРМУ</a>
        </div>
    </div>

    <div class="content">
        <div class="filters">
            <select id="groupFilter">
                <option value="all">ВСЕ ГРУППЫ</option>
            </select>
            <input type="text" id="searchInput" placeholder="Поиск по имени...">
        </div>

        <div id="students">
            <!-- Сюда загружаются студенты -->
        </div>
    </div>

<script>
    // Простой API URL (старый рабочий)
    const API_URL = 'https://script.google.com/macros/s/AKfycby4U365iMv8mZVELhEJFjII0CZ262-gpclf_lUPXvoClpQNtDkFQsS-pLGTbxLZ6bK6/exec';
    
    let studentsData = [];
    let currentGroup = 'all';
    let searchQuery = '';

    // Простая функция загрузки данных
    async function loadStudents() {
        try {
            console.log('Загрузка данных...');
            const response = await fetch(API_URL);
            const data = await response.json();
            
            studentsData = data;
            updateFilters();
            displayStudents();
            
        } catch (error) {
            console.error('Ошибка загрузки:', error);
            // Загрузка тестовых данных при ошибке
            loadSampleData();
        }
    }

    function loadSampleData() {
        studentsData = [
            {name: 'Иванов Алексей', group: 'Группа A', total: 85},
            {name: 'Петрова Мария', group: 'Группа B', total: 92},
            {name: 'Сидоров Дмитрий', group: 'Группа A', total: 78},
            {name: 'Козлова Анна', group: 'Группа C', total: 88},
            {name: 'Николаев Петр', group: 'Группа B', total: 65}
        ];
        updateFilters();
        displayStudents();
    }

    function updateFilters() {
        const groupFilter = document.getElementById('groupFilter');
        const groups = [...new Set(studentsData.map(s => s.group))];
        
        groupFilter.innerHTML = '<option value="all">ВСЕ ГРУППЫ</option>';
        groups.forEach(group => {
            const option = document.createElement('option');
            option.value = group;
            option.textContent = group;
            groupFilter.appendChild(option);
        });
    }

    function displayStudents() {
        const container = document.getElementById('students');
        const filtered = studentsData.filter(student => {
            const groupMatch = currentGroup === 'all' || student.group === currentGroup;
            const nameMatch = student.name.toLowerCase().includes(searchQuery.toLowerCase());
            return groupMatch && nameMatch;
        }).sort((a, b) => b.total - a.total);

        container.innerHTML = '';

        filtered.forEach(student => {
            const studentDiv = document.createElement('div');
            studentDiv.className = 'student-bar';
            
            studentDiv.innerHTML = `
                <div class="student-info">
                    <span class="student-name">${student.name.toUpperCase()}</span>
                    <span>${student.total} БАЛЛОВ</span>
                </div>
                <div class="bar">
                    <div class="bar-fill" style="width: ${Math.min(student.total, 100)}%">
                        ${student.total}
                    </div>
                </div>
            `;
            
            container.appendChild(studentDiv);
        });
    }

    function scrollToContent() {
        document.querySelector('.content').scrollIntoView({ behavior: 'smooth' });
    }

    // Обработчики событий
    document.getElementById('groupFilter').addEventListener('change', function(e) {
        currentGroup = e.target.value;
        displayStudents();
    });

    document.getElementById('searchInput').addEventListener('input', function(e) {
        searchQuery = e.target.value;
        displayStudents();
    });

    // Загрузка при старте
    loadStudents();
</script>
</body>
